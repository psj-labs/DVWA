# Weak Session IDs

- Weak Session ID 취약점은 세션 값이 예측 가능하거나 규칙적으로 증가하는 구조로 생성될 경우, 공격자가 이를 추측하여 다른 사용자의 세션을 탈취할 수 있는 취약점입니다.

---

## 정상 동작 확인

- 다음은 DVWA의 Weak Session IDs 실습 화면입니다.
- `Generate` 버튼을 클릭하면 새로운 세션 값이 발급됩니다.

![01](Weak%20Session%20IDs/imgs/01.png)

- 발급된 세션 값을 확인하면 다음과 같이 쿠키가 설정됩니다.

![03](Weak%20Session%20IDs/imgs/03.png)

- 14번째 줄에서 다음과 같은 값을 확인할 수 있습니다.

```
dvwaSession=2;
```

- 다시 `Generate`를 클릭하면 다음과 같이 세션 값이 증가합니다.

![04](Weak%20Session%20IDs/imgs/04.png)

- 기존 세션 값 2에서 1이 증가한 3이 발급되는 것을 확인할 수 있습니다.

- 이를 통해 세션 값이 **단순 증가 방식으로 생성되고 있음**을 알 수 있습니다.

---

## 취약점 분석

- 세션 값이 2 → 3 → 4와 같이 순차적으로 증가한다면,
- 공격자는 해당 규칙을 추측할 수 있습니다.

- 예를 들어 세션 값을 다음과 같이 수정합니다.

![05](Weak%20Session%20IDs/imgs/05.png)

- 쿠키 값을 `1`로 변경하면,
- 세션 값 1에 해당하는 사용자 권한이 로드될 수 있습니다.

- 이는 세션 값을 추측하여 타인의 세션으로 접근하는  
  **세션 하이재킹(Session Hijacking)** 공격입니다.

---

## 취약 원인 분석

- 세션 ID가 서버가 아닌 애플리케이션 로직에서 직접 생성됨
- 세션 값이 예측 가능한 규칙(순차 증가)으로 구성됨
- 세션 값에 난수성이 없음
- 세션 ID에 암호학적 안전성이 적용되지 않음

- 세션은 인증 정보를 대체하는 핵심 식별 값이므로,
- 예측 가능하면 곧 인증 우회가 가능합니다.

---

## 대응 방안

### 1. PHP 기본 세션 메커니즘 사용

- 세션 ID는 애플리케이션에서 직접 생성하지 않고,
- 반드시 PHP의 기본 세션 기능을 사용합니다.

```
session_start();
```

- PHP는 내부적으로 난수 기반의 안전한 세션 ID를 생성합니다.

---

### 2. 안전한 난수 기반 세션 값 생성

- 반드시 쿠키를 직접 생성해야 하는 경우,
- 예측 불가능한 값으로 생성해야 합니다.

- 예시

```
bin2hex(random_bytes(16));
```

또는

```
hash('sha256', random_bytes(32));
```

- 단순 증가값, timestamp, mt_rand() 단독 사용은 안전하지 않습니다.

---

### 3. 추가 보안 설정

- HttpOnly 옵션 적용
- Secure 옵션 적용 (HTTPS 환경)
- SameSite 속성 설정
- 로그인 시 세션 재발급 (Session Regeneration)

---

## 정리

- 세션 ID는 인증을 대신하는 핵심 식별자입니다.
- 세션 값이 예측 가능하면 곧 인증 우회가 가능합니다.
- 순차 증가 방식의 세션 발급은 치명적인 설계 오류입니다.
- 세션 ID는 반드시 암호학적으로 안전한 난수 기반으로 생성해야 합니다.
